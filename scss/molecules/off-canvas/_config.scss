////
/// @author Raphael HÃ¼ni
/// @group Molecules - Navigation
////

$off-canvas-container-padding: rem-calc(24 0 24 36) !default;
$off-canvas-container-padding-vertical: rem-calc(24) !default;
$off-canvas-container-padding-horizontal: rem-calc(36) !default;

$off-canvas-width: rem-calc(270) !default;
$off-canvas-background-color: $color-secondary !default;
$off-canvas-background-active: $color-primary !default;
$off-canvas-submenu-background: $off-canvas-background-color !default;

$off-canvas-font-color: $white !default;
$off-canvas-font-size: rem-calc(18) !default;
$off-canvas-text-align: left !default;
$off-canvas-text-decoration-hover: none !default;

$off-canvas-list-item-border-bottom: 1px solid $darken !default;

$off-canvas-link-height: rem-calc(48) !default;
$off-canvas-link-line-height: $off-canvas-link-height !default;

$off-canvas-home-icon-size: $off-canvas-font-size !default;

$off-canvas-toggle-size: rem-calc(36) !default;

$off-canvas-meta-font-size: rem-calc(14) !default;
$off-canvas-meta-spacing: rem-calc(12) !default;

$off-canvas-triangle-height: rem-calc(16) !default;

$meta-block-margin: rem-calc(72) !default;
$meta-block-padding: $vertical-spacing !default;

/// This mixin lets one create an off-canvas navigation quite flexibly. Many options are available through the parameters of the mixin such as positioning of the navigation (left or right), the use of a home icon or of an additional meta navigation. Also all classes used for styling are given as parameters to the mixin.
///
/// The default values will finally perfectly reflect the standard WordPress classes generated by the `wp_nav_menu` function.
///
/// @param {String} $container ['.off-canvas-container'] - Class used for the `nav` element.
/// @param {String} $list ['.off-canvas-list'] - Class used for the `ul` element.
/// @param {String} $list-item ['.off-canvas-list-item'] - Class used for all `li` elements.
/// @param {String} $current-item ['.current-menu-item'] - Class used to indicate the current menu item (usually given/generated by your CMS, adjust accordingly).
/// @param {String} $submenu ['.menu'] - Class used for submenu `ul` elements.
/// @param {String} $is-open ['.is-open'] - Class that indicates that the off-canvas navigation is open (usually applied through JS, make sure this is the same there).
/// @param {'left' | 'right'} $position ['right'] - Defines the position of the off canvas navigation (whether it is off the right or left edge of the page).
/// @param {Boolean} $home-icon [true] - Indicates whether a home icon is used to style the home link.
/// @param {String} $home-icon-selector ['.menu-item-home'] - Class that indicates the home link (usually given/generated by your CMS).
/// @param {Boolean} $home-icon-text [false] - If an icon is used indicates whether there still is text besides the icon (`true`) or whether it should stand alone (`false`).
/// @param {Boolean} $toggle [true] - Indicates whether a toggle switch is used.
/// @param {String} $toggle-selector ['.off-canvas-toggle'] - Class that indicates the off canvas toggle switch.
/// @param {Boolean} $meta [true] - Indicates whether we add a meta navigation to the off canvas.
/// @param {String} $meta-selector ['.off-canvas-meta'] - Class that is used for the meta navigation's `nav` element.
/// @param {String} $meta-list-item ['.off-canvas-list-item'] - Class that is used for the meta navigation list items.
///
/// @example scss - WordPress ready off-canvas with home icon and home text but without meta
///   @include off-canvas(
///     // everything else is set correctly by the default values
///     $home-icon-text: true,
///     $meta: false
///   )
///
/// @requires clearfix
/// @requires triangle
///
/// @since 0.1.0
///
/// @todo adjust mixin for WordPress
@mixin off-canvas(
  $container: '.off-canvas-container',
  $list: '.off-canvas-list',
  $list-item: '.off-canvas-list-item',
  $current-item: '.current-menu-item',
  $submenu: '.menu',
  $toggle: '.off-canvas-toggle',
  $is-open: '.is-open',
  $position: 'right',
  $home-icon: true,
  $home-icon-selector: '.menu-item-home',
  $home-icon-text: false,
  $toggle: true,
  $toggle-selector: '.off-canvas-toggle',
  $meta: true,
  $meta-selector: '.off-canvas-meta',
  $meta-list-item: '.off-canvas-list-item'
) {
  // set positional variables
  @if ($position == 'right') {
    $right: true;
    $left: false;
  } @elseif ($position == 'left') {
    $left: true;
    $right: false;
  } @else {
    @warn 'Position can only be left or right at the moment. Please check the setting you passed to your mixin.';
  }

  @if $left {
    $container-padding: $off-canvas-container-padding-vertical $off-canvas-container-padding-horizontal $off-canvas-container-padding-vertical 0;

    $off-canvas-triangle-position: 'right';

    $translate: translate3d(-$off-canvas-width, 0, 0);
  }

  @if $right {
    $container-padding: $off-canvas-container-padding-vertical 0 $off-canvas-container-padding-vertical $off-canvas-container-padding-horizontal;

    $off-canvas-triangle-position: 'left';

    $translate: translate3d($off-canvas-width, 0, 0);
  }

  #{$container} {
    @include clearfix;

    position: absolute;
    top: 0;
    bottom: 0;
    @if $left {
      left: 0;
    }
    @if $right {
      right: 0;
    }

    width: $off-canvas-width;

    padding: $container-padding;

    // this moves the container off the visible area of the screen (as it moves it by its own width to the right and is positioned at the right edge)
    transform: $translate;

    background-color: $off-canvas-background-color;

    .in & {
      @include susy-media(max-mobile) {
        // transform: translate3d(0, 0, 0);
      }
    }
  }

  #{$list} {
    list-style: none;
  }

  #{$list-item} {
    border-bottom: $off-canvas-list-item-border-bottom;
    text-align: $off-canvas-text-align;

    #{$submenu} {
      position: absolute;
      top: 0;
      bottom: 0;
      @if $left {
        left: 0;
      }
      @if $right {
        right: 0;
      }

      width: $off-canvas-width;
      padding: $container-padding;

      overflow-x: hidden;
      overflow-y: auto;

      transform: $translate;
      transition: transform 500ms ease;

      background-color: $off-canvas-background-color;

      list-style: none;

      z-index: 10;

      &.in {
        transform: translate3d(0%, 0, 0);
      }
    }

    a {
      display: block;
      height: $off-canvas-link-height;

      color: $off-canvas-font-color;
      font-size: $off-canvas-font-size;
      line-height: $off-canvas-link-line-height;

      &:hover,
      &:active,
      &:focus,
      #{$current-item} & {
        @include triangle(
          $pos: $off-canvas-triangle-position,
          $offset: 0,
          $direction: out,
          $width: $off-canvas-link-height,
          $height: $off-canvas-triangle-height,
          $color: $off-canvas-background-active
        );

        background-color: $off-canvas-background-active;
        text-decoration: $off-canvas-text-decoration-hover;
      }
    }

    // if a home icon should be displayed next to or instead of the home link, the correct styles are added here
    @if $home-icon {
      &#{$home-icon-selector} a {
        background-size: $off-canvas-home-icon-size;
        @if $home-icon-text {
          background-position: left center;
        } @else {
          background-position: center;
        }

        // if the link text should be displayed next to the home icon, we make room for it by setting a padding of the icon size plus a little breathing room (might also be defined through a variable?). If no text should be displayed, the text given is indented out of view to keep the navigation link accessible for screenreaders...
        @if $home-icon-text {
          padding-left: $off-canvas-home-icon-size + .25rem;
        } @else {
          text-indent: -9999px;
        }
      }
    }
  }

  @if $toggle {
    #{$toggle-selector} {
      display: block;

      width: $header-height;
      height: $header-height;

      // the toggle is positioned to the side where the off canvas is hidden
      float: $position;

      background-position: center center;
      background-size: $off-canvas-toggle-size;

      // hide the text but keep it accessible for screen readers
      text-indent: -9999px;

      // we only show the toggle when the off canvas navigation is active, therefore hide it for wide enough screens
      @include susy-media(go-desktop) {
        display: none;
      }
    }
  }

  @if $meta {
    #{$meta-selector} {
      // the meta nav should be at the bottom and horizontally centered
      position: absolute;
      bottom: $off-canvas-container-padding-vertical;

      // horizontal centering hack
      left: 50%;
      transform: translateX(-50%);

      // accout for possible container padding
      @if $left {
        margin-right: $off-canvas-container-padding-horizontal;
      }

      @if $right {
        margin-left: $off-canvas-container-padding-horizontal;
      }
    }

    #{$meta-list-item} {
      margin-bottom: $off-canvas-meta-spacing;
      font-size: $off-canvas-meta-font-size;
      text-align: center;

      a {
        display: block;
      }
    }
  }
}
